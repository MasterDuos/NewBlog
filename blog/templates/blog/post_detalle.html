{% extends "base.html" %}

{% block title %}{{ post.titulo }} - NewBlog{% endblock %}

{% block content %}
  <div class="post-detail">
    <!-- Imagen -->
    {% if post.imagen %}
      <img src="{{ post.imagen.url }}" alt="{{ post.titulo }}" class="post-detail-img">
    {% endif %}

    <!-- Título -->
    <h2>{{ post.titulo }}</h2>

    <!-- Metadatos -->
    <div class="post-meta">
      📅 {{ post.fecha_creacion|date:"d/m/Y H:i" }}  
      ✍️ por <strong>{{ post.autor.username }}</strong>
    </div>

    <!-- Contenido -->
    <div class="post-content">
      {{ post.contenido|linebreaks }}
    </div>

    <!-- Acciones (editar / eliminar) -->
    {% if user.is_authenticated and user == post.autor %}
      <div class="actions" style="margin-top:1.5rem;">
        <a href="{% url 'editar_post' post.id %}" class="btn">✏ Editar</a>
        <a href="{% url 'eliminar_post' post.id %}" class="btn delete">🗑 Eliminar</a>
      </div>
    {% endif %}

    <!-- 🔹 Reacciones -->
    <div style="margin-top:2rem;">
      <strong>Reacciones:</strong><br>
      <a href="{% url 'reaccionar' post.id 'like' %}" class="btn {% if ya_reacciono.like %}active{% endif %}">👍 ({{ conteos.like }})</a>
      <a href="{% url 'reaccionar' post.id 'love' %}" class="btn {% if ya_reacciono.love %}active{% endif %}">❤️ ({{ conteos.love }})</a>
      <a href="{% url 'reaccionar' post.id 'laugh' %}" class="btn {% if ya_reacciono.laugh %}active{% endif %}">😂 ({{ conteos.laugh }})</a>
    </div>

    <!-- 🔹 Comentarios destacados -->
    <div class="comments">
      <h3 style="margin-top:2rem;">⭐ Comentarios destacados</h3>
      {% if destacados %}
        <ul class="comment-list">
          {% for comentario in destacados %}
            <li class="comment-item destacado" style="border:2px solid gold; padding:10px; margin-bottom:10px;">
              <strong>{{ comentario.autor.username }}</strong> dijo:<br>
              {{ comentario.contenido|linebreaks }}
              <br>
              <small style="color:#777;">📅 {{ comentario.fecha_creacion|date:"d/m/Y H:i" }}</small>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No hay comentarios destacados.</p>
      {% endif %}
    </div>

    <!-- 🔹 Resto de comentarios -->
    <div class="comments">
      <h3 style="margin-top:2rem;">💬 Comentarios</h3>
      {% if comentarios %}
        <ul class="comment-list">
          {% for comentario in comentarios %}
            <li class="comment-item {% if comentario.destacado %}destacado{% endif %}">
              <strong>{{ comentario.autor.username }}</strong> dijo:<br>
              {{ comentario.contenido|linebreaks }}
              <br>
              <small style="color:#777;">📅 {{ comentario.fecha_creacion|date:"d/m/Y H:i" }}</small>
              <br>
              <strong>Votos:</strong> {{ comentario.votos_totales }}
              <br>

              {% if user.is_authenticated %}
                <!-- Votar -->
                <a href="{% url 'votar_comentario' comentario.id 'up' %}" class="btn">👍</a>
                <a href="{% url 'votar_comentario' comentario.id 'down' %}" class="btn delete">👎</a>

                <!-- Reportar -->
                <a href="{% url 'reportar_comentario' comentario.id %}" class="btn">🚩 Reportar</a>

                <!-- Eliminar (solo autor o admin) -->
                {% if user == comentario.autor or user.is_superuser %}
                  <a href="{% url 'eliminar_comentario' comentario.id %}" class="btn delete">🗑 Eliminar</a>
                {% endif %}
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No hay comentarios todavía. Sé el primero en comentar 🎉</p>
      {% endif %}

      <!-- Formulario de nuevo comentario -->
      {% if user.is_authenticated %}
        <form method="post" class="comment-form">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit" name="comentario" class="btn">➕ Agregar comentario</button>
        </form>
      {% else %}
        <p><a href="{% url 'login' %}">Inicia sesión</a> para comentar.</p>
      {% endif %}
    </div>

    <!-- Volver -->
    <div style="margin-top:2rem;">
      <a href="{% url 'home' %}" class="btn">⬅ Volver al inicio</a>
    </div>
  </div>
{% endblock %}

<!-- Comentarios destacados -->
{% if destacados %}
  <ul>
    {% for comentario in destacados %}
      <li style="border:2px solid gold; padding:10px;">
        ⭐ <strong>{{ comentario.autor.username }}</strong>: {{ comentario.contenido }}
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>No hay comentarios destacados.</p>
{% endif %}

<!-- Comentarios normales -->
{% for comentario in comentarios %}
  <li>
    <strong>{{ comentario.autor.username }}</strong>: {{ comentario.contenido }}
  </li>
{% endfor %}
