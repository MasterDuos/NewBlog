{% extends "base.html" %}

{% block title %}{{ post.titulo }} - NewBlog{% endblock %}

{% block content %}
  <div class="post-detail">
    <!-- Imagen -->
    {% if post.imagen %}
      <img src="{{ post.imagen.url }}" alt="{{ post.titulo }}" class="post-detail-img">
    {% endif %}

    <!-- TÃ­tulo -->
    <h2>{{ post.titulo }}</h2>

    <!-- Metadatos -->
    <div class="post-meta">
      ğŸ“… {{ post.fecha_creacion|date:"d/m/Y H:i" }}  
      âœï¸ por <strong>{{ post.autor.username }}</strong>
    </div>

    <!-- Contenido -->
    <div class="post-content">
      {{ post.contenido|linebreaks }}
    </div>

    <!-- Acciones (editar / eliminar) -->
    {% if user.is_authenticated and user == post.autor %}
      <div class="actions" style="margin-top:1.5rem;">
        <a href="{% url 'editar_post' post.id %}" class="btn">âœ Editar</a>
        <a href="{% url 'eliminar_post' post.id %}" class="btn delete">ğŸ—‘ Eliminar</a>
      </div>
    {% endif %}

    <!-- ğŸ”¹ Reacciones -->
    <div style="margin-top:2rem;">
      <strong>Reacciones:</strong><br>
      <a href="{% url 'reaccionar' post.id 'like' %}" class="btn">ğŸ‘ ({{ conteos.like }})</a>
      <a href="{% url 'reaccionar' post.id 'love' %}" class="btn">â¤ï¸ ({{ conteos.love }})</a>
      <a href="{% url 'reaccionar' post.id 'laugh' %}" class="btn">ğŸ˜‚ ({{ conteos.laugh }})</a>
    </div>

    <!-- ğŸ”¹ Mejores comentarios -->
    <div class="comments">
      <h3 style="margin-top:2rem;">ğŸ’¬ Mejores comentarios</h3>

      {% if comentarios %}
        <ul class="comment-list">
          {% for comentario in comentarios %}
            <li class="comment-item">
              <strong>{{ comentario.autor.username }}</strong> dijo:<br>
              {{ comentario.contenido|linebreaks }}
              <br>
              <small style="color:#777;">ğŸ“… {{ comentario.fecha_creacion|date:"d/m/Y H:i" }}</small>
              <br>
              <strong>Votos:</strong> {{ comentario.votos_totales }}
              <br>
              {% if user.is_authenticated %}
                <a href="{% url 'votar_comentario' comentario.id 'up' %}" class="btn">ğŸ‘</a>
                <a href="{% url 'votar_comentario' comentario.id 'down' %}" class="btn delete">ğŸ‘</a>

              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No hay comentarios todavÃ­a. SÃ© el primero en comentar ğŸ‰</p>
      {% endif %}

      <!-- Formulario de nuevo comentario -->
      {% if user.is_authenticated %}
        <form method="post" class="comment-form">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit" name="comentario" class="btn">â• Agregar comentario</button>
        </form>
      {% else %}
        <p><a href="{% url 'login' %}">Inicia sesiÃ³n</a> para comentar.</p>
      {% endif %}
    </div>

    <!-- Volver -->
    <div style="margin-top:2rem;">
      <a href="{% url 'home' %}" class="btn">â¬… Volver al inicio</a>
    </div>
  </div>
{% endblock %}
